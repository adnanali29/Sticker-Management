<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chia Jiya Stickers - Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
    
    <style>
        /* ... (Keep all existing CSS styles) ... */
        body {
            box-sizing: border-box;
        }
       

        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100%;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        @media (min-width: 768px) {
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
            }
            100% {
                box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            padding: 1rem;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .modal {
                padding: 0.5rem;
                align-items: flex-start;
                padding-top: 2rem;
            }
            
            .modal .bg-white,
            .modal .bg-gray-900 {
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .text-responsive {
                font-size: 1.25rem;
            }
            
            .grid-responsive {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 641px) and (max-width: 768px) {
            .text-responsive {
                font-size: 1.5rem;
            }
        }
        
        /* Scrollbar styling for mobile */
        .overflow-y-auto::-webkit-scrollbar {
            width: 4px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        /* Quick stock button container - responsive fix */
.quick-stock-container {
    display: flex;
    gap: 0.5rem;
    align-items: stretch;
}

.quick-stock-container input {
    flex: 1;
    min-width: 0; /* Allows flex item to shrink below content size */
}

.quick-stock-container button {
    flex-shrink: 0; /* Prevents buttons from shrinking */
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
}

@media (max-width: 640px) {
    .quick-stock-container button {
        width: 32px;
        height: 32px;
        font-size: 1rem;
    }
}
    </style>
</head>
<body class="gradient-bg">
    <div id="loginPage" class="page active">
        <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-gray-900/90 backdrop-blur-lg rounded-3xl shadow-2xl border border-gray-700/50 p-8 w-full max-w-md">
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4">ü•§</div>
                    <h1 class="text-3xl font-bold text-white mb-2">Chia Jiya Stickers</h1>
                    <p class="text-gray-300">Admin Dashboard</p>
                </div>
                
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                        <div class="relative">
                            <input type="password" id="password" required 
                                   class="w-full px-4 py-3 pr-12 border border-gray-600 rounded-lg bg-gray-800/50 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-300 transition-colors">
                                <span id="eyeIcon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all pulse-glow">
                        Login
                    </button>
                    
                    <button type="button" id="resetPasswordBtn" class="w-full text-blue-400 hover:text-blue-300 transition-colors">
                        Reset Password
                    </button>
                </form>
                
                <div id="loginError" class="mt-4 text-red-400 text-center hidden"></div>
            </div>
        </div>
    </div>

    <div id="dashboardPage" class="page">
        <div class="min-h-screen p-4">
            <div class="bg-gray-900/90 backdrop-blur-lg rounded-2xl shadow-lg border border-gray-700/50 p-3 sm:p-4 mb-4 sm:mb-6">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <div class="text-2xl sm:text-4xl">ü•§</div>
                        <div>
                            <h1 class="text-lg sm:text-2xl lg:text-3xl font-bold text-white leading-tight">Stickers Management System</h1>
                            <p class="text-gray-300 text-sm sm:text-base">Chia Jiya Stickers</p>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2">
                        <button id="resetBtn" class="bg-orange-500 text-white px-2 sm:px-4 py-1 sm:py-2 rounded-lg hover:bg-orange-600 transition-colors shadow-lg text-xs sm:text-sm">
                            Reset
                        </button>
                        <button id="logoutBtn" class="bg-red-500 text-white px-2 sm:px-4 py-1 sm:py-2 rounded-lg hover:bg-red-600 transition-colors shadow-lg text-xs sm:text-sm">
                            Logout
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4 sm:mb-6">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 sm:p-6 text-white card-hover cursor-pointer" onclick="showPage('stockPage')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-base sm:text-lg font-semibold mb-1 sm:mb-2">Total Stock</h3>
                            <p class="text-2xl sm:text-3xl font-bold" id="totalStockCount">0</p>
                            <p class="text-blue-100 text-xs sm:text-sm">Total Pieces</p>
                        </div>
                        <div class="text-3xl sm:text-5xl opacity-80">üì¶</div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-4 sm:p-6 text-white card-hover cursor-pointer" onclick="showPage('stockValuePage')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-base sm:text-lg font-semibold mb-1 sm:mb-2">Stock Value</h3>
                            <p class="text-2xl sm:text-3xl font-bold">‚Çπ<span id="totalStockValue">0</span></p>
                            <p class="text-green-100 text-xs sm:text-sm">Total Investment</p>
                        </div>
                        <div class="text-3xl sm:text-5xl opacity-80">üí∞</div>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-3 sm:p-4 text-white card-hover flex flex-col">
                    <div class="flex items-center justify-between mb-2 sm:mb-3">
                        <div>
                            <h3 class="text-sm sm:text-base font-semibold mb-1">Vendors</h3>
                            <p class="text-xl sm:text-2xl font-bold" id="totalVendors">0</p>
                            <p class="text-purple-100 text-xs sm:text-sm">Active Suppliers</p>
                        </div>
                        <div class="text-2xl sm:text-3xl opacity-80">üè™</div>
                    </div>
                    <div class="grid grid-cols-2 gap-1 sm:gap-2 mt-auto">
                        <button onclick="showAddVendorModal()" class="bg-white text-purple-600 py-1.5 sm:py-2 px-2 sm:px-3 rounded-lg hover:bg-gray-100 transition-all font-medium text-xs sm:text-sm">
                            ‚ûï Add
                        </button>
                        <button onclick="showPage('vendorsPage')" class="bg-purple-700 text-white py-1.5 sm:py-2 px-2 sm:px-3 rounded-lg hover:bg-purple-800 transition-all font-medium text-xs sm:text-sm">
                            üë• View
                        </button>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-3 sm:p-4 text-white card-hover flex flex-col">
                    <div class="flex items-center justify-between mb-2 sm:mb-3">
                        <div>
                            <h3 class="text-sm sm:text-base font-semibold mb-1">Stock Management</h3>
                            <p class="text-orange-100 text-xs sm:text-sm">Add or Remove Stock</p>
                        </div>
                        <div class="text-2xl sm:text-3xl opacity-80">üìä</div>
                    </div>
                    <div class="grid grid-cols-2 gap-1 sm:gap-2 mt-auto">
                        <button onclick="showStockInModal()" class="bg-white text-orange-600 py-1.5 sm:py-2 px-2 sm:px-3 rounded-lg hover:bg-gray-100 transition-all font-medium text-xs sm:text-sm">
                            üì• In
                        </button>
                        <button onclick="showStockOutModal()" class="bg-orange-700 text-white py-1.5 sm:py-2 px-2 sm:px-3 rounded-lg hover:bg-orange-800 transition-all font-medium text-xs sm:text-sm">
                            üì§ Out
                        </button>
                    </div>
                </div>
            </div>

            <div class="bg-gradient-to-br from-slate-50 to-blue-50 rounded-2xl sm:rounded-3xl shadow-xl p-4 sm:p-6 lg:p-8">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 sm:mb-6 lg:mb-8 gap-3 sm:gap-0">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 flex items-center">
                        <span class="text-2xl sm:text-3xl lg:text-4xl mr-2 sm:mr-3 lg:mr-4">üìã</span>
                        Current Inventory
                    </h2>
                    <div class="bg-white text-blue-600 font-bold px-3 sm:px-4 py-1.5 sm:py-2 rounded-full shadow-md text-sm sm:text-base">
                        <span id="inventoryCount">0</span> items
                    </div>
                </div>
                <div id="inventoryGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                    <div class="col-span-full flex flex-col items-center justify-center py-12 sm:py-16">
                        <div class="text-6xl sm:text-8xl mb-4 sm:mb-6 opacity-30">üì¶</div>
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-400 mb-2 sm:mb-3 text-center">No inventory items yet</h3>
                        <p class="text-gray-500 text-base sm:text-lg text-center">Add your first product to get started!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="stockPage" class="page">
        <div class="min-h-screen p-3 sm:p-4 lg:p-6">
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3 sm:gap-0">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 flex items-center">
                        <span class="text-2xl sm:text-3xl lg:text-4xl mr-2 sm:mr-3">üì¶</span>
                        Total Stock Details
                    </h2>
                    <button onclick="showPage('dashboardPage')" class="bg-blue-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm sm:text-base">
                        Back to Dashboard
                    </button>
                </div>
                <div id="stockDetails" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                    </div>
            </div>
        </div>
    </div>

    <div id="stockValuePage" class="page">
        <div class="min-h-screen p-3 sm:p-4 lg:p-6">
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3 sm:gap-0">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 flex items-center">
                        <span class="text-2xl sm:text-3xl lg:text-4xl mr-2 sm:mr-3">üí∞</span>
                        Stock Value Details
                    </h2>
                    <button onclick="showPage('dashboardPage')" class="bg-green-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm sm:text-base">
                        Back to Dashboard
                    </button>
                </div>
                <div id="stockValueDetails" class="overflow-x-auto">
                    </div>
            </div>
        </div>
    </div>

    <div id="vendorsPage" class="page">
        <div class="min-h-screen p-3 sm:p-4 lg:p-6">
            <div class="bg-white rounded-2xl shadow-lg p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3 sm:gap-0">
                    <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 flex items-center">
                        <span class="text-2xl sm:text-3xl lg:text-4xl mr-2 sm:mr-3">üè™</span>
                        Vendors Management
                    </h2s>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-4">
                        <button onclick="showAddVendorModal()" class="bg-purple-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm sm:text-base">
                            Add Vendor
                        </button>
                        <button onclick="showPage('dashboardPage')" class="bg-gray-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                            Back to Dashboard
                        </button>
                    </div>
                </div>
                <div id="vendorsDetails" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-3 sm:gap-4">
                    </div>
            </div>
        </div>
    </div>

    <div id="stockInModal" class="modal">
        <div class="bg-white rounded-2xl p-4 sm:p-6 lg:p-8 w-full max-w-2xl mx-2 sm:mx-4">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center">
                <span class="text-2xl sm:text-3xl mr-2 sm:mr-3">üì•</span>
                Stock In
            </h3>
            <form id="stockInForm" class="space-y-3 sm:space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Product Name</label>
                        <input type="text" id="stockInName" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm sm:text-base">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Date</label>
                        <input type="date" id="stockInDate" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm sm:text-base">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sheet Type</label>
                        <select id="stockInSheetType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="handleCustomType('sheet')">
                            <option value="">Select Sheet Type</option>
                            <option value="Paper Gumming">Paper Gumming</option>
                            <option value="NT Opec">NT Opec</option>
                            <option value="Silver Sticker">Silver Sticker</option>
                            <option value="Golden Sticker">Golden Sticker</option>
                            <option value="Transparent Sticker">Transparent Sticker</option>
                            <option value="custom">+ Add New Sheet Type</option>
                        </select>
                        <input type="text" id="customSheetType" placeholder="Enter new sheet type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mt-2 hidden">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sticker Type</label>
                        <select id="stockInStickerType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" onchange="handleCustomType('sticker')">
                            <option value="">Select Sticker Type</option>
                            <option value="Long Front">Long Front</option>
                            <option value="Long Back">Long Back</option>
                            <option value="Square Back">Square Back</option>
                            <option value="Die-Cut Front">Die-Cut Front</option>
                            <option value="custom">+ Add New Sticker Type</option>
                        </select>
                        <input type="text" id="customStickerType" placeholder="Enter new sticker type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mt-2 hidden">
                    </div>
                    <div id="sheetsField">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Sheets</label>
                        <input type="number" id="stockInSheets" required min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div id="piecesPerSheetField">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pieces per Sheet</label>
                        <input type="number" id="stockInPiecesPerSheet" required min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div id="piecesField" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Pieces</label>
                        <input type="number" id="stockInPieces" min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cost per Sheet</label>
                        <input type="number" id="stockInCostPerSheet" required min="0" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vendor</label>
                        <select id="stockInVendor" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Vendor</option>
                        </select>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 pt-3 sm:pt-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2.5 sm:py-3 rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base">
                        Add Stock
                    </button>
                    <button type="button" onclick="closeModal('stockInModal')" class="flex-1 bg-gray-500 text-white py-2.5 sm:py-3 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="stockOutModal" class="modal">
        <div class="bg-white rounded-2xl p-4 sm:p-6 lg:p-8 w-full max-w-2xl mx-2 sm:mx-4">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center">
                <span class="text-2xl sm:text-3xl mr-2 sm:mr-3">üì§</span>
                Stock Out
            </h3>
            <div id="stockOutList" class="space-y-3 sm:space-y-4 max-h-80 sm:max-h-96 overflow-y-auto">
                </div>
            <div class="flex justify-end pt-3 sm:pt-4">
                <button onclick="closeModal('stockOutModal')" class="bg-gray-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div id="addVendorModal" class="modal">
        <div class="bg-white rounded-2xl p-4 sm:p-6 lg:p-8 w-full max-w-2xl mx-2 sm:mx-4">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center">
                <span class="text-2xl sm:text-3xl mr-2 sm:mr-3">üè™</span>
                Add New Vendor
            </h3>
            <form id="addVendorForm" class="space-y-3 sm:space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Vendor Name</label>
                        <input type="text" id="vendorName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Contact Person</label>
                        <input type="text" id="vendorContact" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input type="tel" id="vendorPhone" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="vendorEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                        <input type="text" id="vendorCity" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                        <select id="vendorState" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                            <option value="">Select State</option>
                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                            <option value="Assam">Assam</option>
                            <option value="Bihar">Bihar</option>
                            <option value="Chhattisgarh">Chhattisgarh</option>
                            <option value="Goa">Goa</option>
                            <option value="Gujarat">Gujarat</option>
                            <option value="Haryana">Haryana</option>
                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                            <option value="Jharkhand">Jharkhand</option>
                            <option value="Karnataka">Karnataka</option>
                            <option value="Kerala">Kerala</option>
                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                            <option value="Maharashtra">Maharashtra</option>
                            <option value="Manipur">Manipur</option>
                            <option value="Meghalaya">Meghalaya</option>
                            <option value="Mizoram">Mizoram</option>
                            <option value="Nagaland">Nagaland</option>
                            <option value="Odisha">Odisha</option>
                            <option value="Punjab">Punjab</option>
                            <option value="Rajasthan">Rajasthan</option>
                            <option value="Sikkim">Sikkim</option>
                            <option value="Tamil Nadu">Tamil Nadu</option>
                            <option value="Telangana">Telangana</option>
                            <option value="Tripura">Tripura</option>
                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                            <option value="Uttarakhand">Uttarakhand</option>
                            <option value="West Bengal">West Bengal</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Address</label>
                    <textarea id="vendorAddress" required rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
                </div>
                <div class="flex space-x-4 pt-4">
                    <button type="submit" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors">
                        Add Vendor
                    </button>
                    <button type="button" onclick="closeModal('addVendorModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="resetPasswordModal" class="modal">
        <div class="bg-gray-900/95 backdrop-blur-lg rounded-2xl border border-gray-700/50 p-8 w-full max-w-md mx-4">
            <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                <span class="text-3xl mr-3">üîê</span>
                Reset Password
            </h3>
            <form id="resetPasswordForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                    <input type="email" id="resetEmail" required class="w-full px-4 py-2 border border-gray-600 rounded-lg bg-gray-800/50 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500" placeholder="Enter your email">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Current Password</label>
                    <input type="password" id="currentPassword" required class="w-full px-4 py-2 border border-gray-600 rounded-lg bg-gray-800/50 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">New Password</label>
                    <input type="password" id="newPassword" required class="w-full px-4 py-2 border border-gray-600 rounded-lg bg-gray-800/50 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Confirm New Password</label>
                    <input type="password" id="confirmPassword" required class="w-full px-4 py-2 border border-gray-600 rounded-lg bg-gray-800/50 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex space-x-4 pt-4">
                    <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all">
                        Reset Password
                    </button>
                    <button type="button" onclick="closeModal('resetPasswordModal')" class="flex-1 bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors">
                        Cancel
                    </button>
                </div>
            </form>
            <div id="resetError" class="mt-4 text-red-400 text-center hidden"></div>
        </div>
    </div>

    <div id="resetConfirmModal" class="modal">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md mx-4">
            <h3 class="text-2xl font-bold text-red-600 mb-6 flex items-center">
                <span class="text-3xl mr-3">‚ö†Ô∏è</span>
                Reset All Data
            </h3>
            <div class="mb-6">
                <p class="text-gray-700 mb-4">Are you sure you want to delete all data? This action will permanently remove:</p>
                <ul class="list-disc list-inside text-gray-600 space-y-1 mb-4">
                    <li>All inventory items</li>
                    <li>All vendor information</li>
                    <li>All transaction history</li>
                </ul>
                <p class="text-red-600 font-semibold">This action cannot be undone!</p>
            </div>
            <div class="flex space-x-4">
                <button onclick="confirmReset()" class="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition-colors">
                    Yes, Delete All Data
                </button>
                <button onclick="closeModal('resetConfirmModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="deleteVendorModal" class="modal">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md mx-4">
            <h3 class="text-2xl font-bold text-red-600 mb-6 flex items-center">
                <span class="text-3xl mr-3">üóëÔ∏è</span>
                Delete Vendor
            </h3>
            <div class="mb-6">
                <p class="text-gray-700 mb-4">Are you sure you want to delete this vendor?</p>
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                    <p class="text-red-800 font-semibold" id="deleteVendorName"></p>
                    <p class="text-red-600 text-sm mt-2" id="deleteVendorWarning"></p>
                </div>
                <p class="text-red-600 font-semibold">This action cannot be undone!</p>
            </div>
            <div class="flex space-x-4">
                <button onclick="confirmDeleteVendor()" class="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition-colors">
                    Yes, Delete Vendor
                </button>
                <button onclick="closeModal('deleteVendorModal')" class="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 transition-colors">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="productHistoryModal" class="modal">
        <div class="bg-white rounded-2xl p-4 sm:p-6 lg:p-8 w-full max-w-4xl mx-2 sm:mx-4 max-h-90vh overflow-y-auto">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center">
                <span class="text-2xl sm:text-3xl mr-2 sm:mr-3">üìä</span>
                Product History - <span id="historyProductName"></span>
            </h3>
            <div id="productHistoryContent" class="space-y-4">
                </div>
            <div class="flex justify-end pt-4 border-t">
                <button onclick="closeModal('productHistoryModal')" class="bg-gray-500 text-white px-4 sm:px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div id="editProductModal" class="modal">
        <div class="bg-white rounded-2xl p-4 sm:p-6 lg:p-8 w-full max-w-2xl mx-2 sm:mx-4">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4 sm:mb-6 flex items-center">
                <span class="text-2xl sm:text-3xl mr-2 sm:mr-3">‚úèÔ∏è</span>
                Edit Product
            </h3>
            <form id="editProductForm" class="space-y-3 sm:space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Product Name</label>
                        <input type="text" id="editProductName" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-sm sm:text-base">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">Vendor</label>
                        <select id="editProductVendor" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 text-sm sm:text-base">
                            <option value="">Select Vendor</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sheet Type</label>
                        <select id="editProductSheetType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" onchange="handleEditCustomType('sheet')">
                            <option value="">Select Sheet Type</option>
                            <option value="Paper Gumming">Paper Gumming</option>
                            <option value="NT Opec">NT Opec</option>
                            <option value="Silver Sticker">Silver Sticker</option>
                            <option value="Golden Sticker">Golden Sticker</option>
                            <option value="Transparent Sticker">Transparent Sticker</option>
                            <option value="custom">+ Add New Sheet Type</option>
                        </select>
                        <input type="text" id="editCustomSheetType" placeholder="Enter new sheet type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 mt-2 hidden">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sticker Type</label>
                        <select id="editProductStickerType" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" onchange="handleEditCustomType('sticker')">
                            <option value="">Select Sticker Type</option>
                            <option value="Long Front">Long Front</option>
                            <option value="Long Back">Long Back</option>
                            <option value="Square Back">Square Back</option>
                            <option value="Die-Cut Front">Die-Cut Front</option>
                            <option value="custom">+ Add New Sticker Type</option>
                        </select>
                        <input type="text" id="editCustomStickerType" placeholder="Enter new sticker type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 mt-2 hidden">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pieces per Sheet</label>
                        <input type="number" id="editProductPiecesPerSheet" required min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Cost per Sheet</label>
                        <input type="number" id="editProductCostPerSheet" required min="0" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 pt-3 sm:pt-4">
                    <button type="submit" class="flex-1 bg-orange-600 text-white py-2.5 sm:py-3 rounded-lg hover:bg-orange-700 transition-colors text-sm sm:text-base">
                        Update Product
                    </button>
                    <button type="button" onclick="closeModal('editProductModal')" class="flex-1 bg-gray-500 text-white py-2.5 sm:py-3 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Supabase Configuration (MUST be at the top) ---
        // ‚ö†Ô∏è WARNING: DO NOT use a public-facing page to store sensitive keys.
        // For a real-world app, rely on Row Level Security (RLS) to protect data.


     // Check if Supabase loaded correctly
let supabaseClient;
try {
    if (typeof supabase === 'undefined') {
        throw new Error('Supabase library not loaded. Check your internet connection.');
    }
    supabaseClient = supabase.createClient(
        'https://qjbrnuwxxfmmelxtvvjz.supabase.co',
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqYnJudXd4eGZtbWVseHR2dmp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzMjUwNDUsImV4cCI6MjA3NjkwMTA0NX0.V_mB1pnv7aIM4L7_tJ9zaPPJbp0zIET94OXvFr53ovo'
    );
    console.log('Supabase client created successfully ‚úì');
} catch (error) {
    console.error('Failed to create Supabase client:', error);
    alert('Failed to initialize database connection. Please refresh the page.');
}
        // Application State
        let currentPassword = 'addy12345';
        let inventory = [];
        let vendors = [];
        let transactions = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', async function() {
            // Fix 2: Wrap all asynchronous initialization logic in a DOMContentLoaded listener
            // to ensure all elements are present before trying to use them.
            // This is already present, but the structure is verified.
            document.getElementById('stockInDate').valueAsDate = new Date();
            await loadData();
            await updateDashboard();
            await populateVendorDropdowns();
        });

        // --- Supabase Data Management Functions (CRUD) ---

        // Load all data from Supabase
        async function loadData() {
            try {
                // If Supabase failed to initialize (e.g., CDN blocked), stop here.
                if (typeof supabase === 'undefined') {
                    throw new Error('Supabase client not initialized. Check CDN and console for errors.');
                }
                
                const [invRes, vendRes, transRes] = await Promise.all([
                    supabaseClient.from('inventory').select('*'),
                    supabaseClient.from('vendors').select('*'),
                    supabaseClient.from('transactions').select('*')
                ]);

                if (invRes.error) throw invRes.error;
                if (vendRes.error) throw vendRes.error;
                if (transRes.error) throw transRes.error;

                // Map Supabase column names (snake_case) to JS state (camelCase)
                inventory = invRes.data.map(item => ({
                    id: item.id,
                    name: item.name,
                    sheetType: item.sheet_type,
                    stickerType: item.sticker_type,
                    pieces: item.pieces,
                    piecesPerSheet: item.pieces_per_sheet,
                    costPerSheet: parseFloat(item.cost_per_sheet),
                    totalCost: parseFloat(item.total_cost),
                    vendor: item.vendor,
                    dateAdded: item.date_added
                }));
                
                vendors = vendRes.data.map(item => ({
                    id: item.id,
                    name: item.name,
                    contact: item.contact,
                    phone: item.phone,
                    email: item.email,
                    city: item.city,
                    state: item.state,
                    address: item.address
                }));

                transactions = transRes.data.map(item => ({
                    id: item.id,
                    productId: item.product_id,
                    type: item.type,
                    productName: item.product_name,
                    quantity: item.quantity,
                    date: item.date,
                    time: item.time,
                    cost: parseFloat(item.cost)
                }));

            } catch (error) {
                console.error('Failed to load data from Supabase:', error.message);
                showNotification('Failed to load data. Check console for details.', 'error');
                inventory = [];
                vendors = [];
                transactions = [];
            }
        }

        // Add/Update Inventory & Transaction (Stock In)
        async function addStockInTransaction(newProductData, existingItem = null) {
            let productId;
            const pieces = newProductData.pieces;
            const totalCost = newProductData.totalCost;
            
            try {
                if (existingItem) {
                    // Update existing inventory item
                    const newPieces = existingItem.pieces + pieces;
                    const newTotalCost = existingItem.totalCost + totalCost;
                    productId = existingItem.id;

                    const { error } = await supabaseClient
                        .from('inventory')
                        .update({ pieces: newPieces, total_cost: newTotalCost })
                        .eq('id', productId);
                    
                    if (error) throw error;

                } else {
                    // Create new inventory item
                    const productToInsert = {
                        name: newProductData.name,
                        sheet_type: newProductData.sheetType,
                        sticker_type: newProductData.stickerType,
                        pieces: newProductData.pieces,
                        pieces_per_sheet: newProductData.piecesPerSheet,
                        cost_per_sheet: newProductData.costPerSheet,
                        total_cost: newProductData.totalCost,
                        vendor: newProductData.vendor,
                        date_added: newProductData.dateAdded
                    };

                    const { data, error } = await supabaseClient
                        .from('inventory')
                        .insert([productToInsert])
                        .select();
                        
                    if (error) throw error;
                    productId = data[0].id;
                }

                // Add transaction record
                const transaction = {
                    product_id: productId,
                    type: 'Stock In',
                    product_name: newProductData.name,
                    quantity: pieces,
                    date: newProductData.dateAdded,
                    time: new Date().toLocaleTimeString(),
                    cost: totalCost
                };

                const { error: transError } = await supabaseClient
                    .from('transactions')
                    .insert([transaction]);
                
                if (transError) throw transError;

                await loadData(); // Refresh local state
                await updateDashboard();
                showNotification('Stock added successfully!', 'success');
                return true;

            } catch (error) {
                console.error('Stock In failed:', error.message);
                showNotification('Stock In failed: ' + error.message, 'error');
                return false;
            }
        }
        
        // Process Stock Out
        async function processStockOutSupabase(itemId, quantity, item) {
            try {
                const costPerPiece = item.costPerSheet / item.piecesPerSheet;
                const stockOutCost = quantity * costPerPiece;
                const newPieces = item.pieces - quantity;
                
                if (newPieces <= 0) {
                    // Delete item if stock is zero or less
                    const { error } = await supabaseClient
                        .from('inventory')
                        .delete()
                        .eq('id', itemId);

                    if (error) throw error;
                } else {
                    // Update item stock
                    const newTotalCost = item.totalCost - stockOutCost;
                    const { error } = await supabaseClient
                        .from('inventory')
                        .update({ pieces: newPieces, total_cost: newTotalCost })
                        .eq('id', itemId);

                    if (error) throw error;
                }

                // Add transaction record
                const transaction = {
                    product_id: itemId,
                    type: 'Stock Out',
                    product_name: item.name,
                    quantity: quantity,
                    date: new Date().toISOString().split('T')[0],
                    time: new Date().toLocaleTimeString(),
                    cost: stockOutCost
                };

                const { error: transError } = await supabaseClient
                    .from('transactions')
                    .insert([transaction]);
                
                if (transError) throw transError;

                await loadData();
                await updateDashboard();
                return true;

            } catch (error) {
                console.error('Stock Out failed:', error.message);
                showNotification('Stock Out failed: ' + error.message, 'error');
                return false;
            }
        }

        // Add/Update Vendor
        async function saveVendor(vendorData, editingId) {
            try {
                let error;
                let result;

                if (editingId) {
                    // Update existing vendor
                    const { data, error: updateError } = await supabaseClient
                        .from('vendors')
                        .update({
                            name: vendorData.name,
                            contact: vendorData.contact,
                            phone: vendorData.phone,
                            email: vendorData.email,
                            city: vendorData.city,
                            state: vendorData.state,
                            address: vendorData.address
                        })
                        .eq('id', editingId)
                        .select();
                    
                    error = updateError;
                    result = data;

                    // If vendor name changed, update all corresponding inventory and transactions
                    if (result && result.length > 0) {
                        const oldVendor = vendors.find(v => v.id == editingId);
                        if (oldVendor && oldVendor.name !== vendorData.name) {
                             const { error: invError } = await supabaseClient
                                .from('inventory')
                                .update({ vendor: vendorData.name })
                                .eq('vendor', oldVendor.name);
                            if (invError) console.error('Error updating inventory vendor names:', invError);
                        }
                    }

                } else {
                    // Add new vendor
                    const vendorToInsert = { ...vendorData };
                    const { data, error: insertError } = await supabaseClient
                        .from('vendors')
                        .insert([vendorToInsert])
                        .select();
                    
                    error = insertError;
                    result = data;
                }

                if (error) {
                    if (error.code === '23505') { // Unique constraint violation (vendor name exists)
                        throw new Error('Vendor name already exists. Please choose a different name.');
                    }
                    throw error;
                }

                await loadData();
                await updateDashboard();
                await populateVendorDropdowns();
                await populateVendorsPage();
                closeModal('addVendorModal');
                document.getElementById('addVendorForm').reset();
                showNotification('Vendor saved successfully!', 'success');
                
            } catch (error) {
                console.error('Vendor save failed:', error.message);
                showNotification(error.message, 'error');
            }
        }

        // Delete Vendor
        async function confirmDeleteVendor() {
            if (!vendorToDelete) return;
            
            try {
                const vendor = vendors.find(v => v.id === vendorToDelete);
                if (!vendor) return;

                // Deleting the vendor
                const { error } = await supabaseClient
                    .from('vendors')
                    .delete()
                    .eq('id', vendorToDelete);
                
                if (error) throw error;
                
                // Note: Inventory items associated with this vendor remain but their vendor field is now outdated.
                // A better approach would be to set vendor to NULL or a default "Deleted Vendor" in inventory.

                await loadData();
                await updateDashboard();
                await populateVendorDropdowns();
                await populateVendorsPage();
                
                showNotification(`Vendor "${vendor.name}" deleted successfully!`, 'success');
                
                vendorToDelete = null;
                closeModal('deleteVendorModal');
                
            } catch (error) {
                console.error('Delete vendor failed:', error.message);
                showNotification('Failed to delete vendor: ' + error.message, 'error');
            }
        }
        
        // Delete All Data (Reset)
        async function confirmReset() {
            try {
                // Delete data from all tables
                await supabaseClient.from('transactions').delete().neq('id', 0);
                await supabaseClient.from('inventory').delete().neq('id', 0);
                await supabaseClient.from('vendors').delete().neq('id', 0);
                
                // Note: 'neq('id', 0)' is a standard way to delete all rows when no RLS is set up.

                await loadData();
                await updateDashboard();
                await populateVendorDropdowns();
                
                closeModal('resetConfirmModal');
                showNotification('All data has been successfully deleted!', 'success');
                
            } catch (error) {
                console.error('Failed to reset data:', error.message);
                showNotification('Failed to reset data. Check console for details.', 'error');
            }
        }
        
        // Update Product (Edit)
        async function updateProduct(itemId, updateData) {
            try {
                const { error } = await supabaseClient
                    .from('inventory')
                    .update(updateData)
                    .eq('id', itemId);
                
                if (error) throw error;

                // Update product name in transactions if it changed
                if (updateData.name) {
                    const { error: transError } = await supabaseClient
                        .from('transactions')
                        .update({ product_name: updateData.name })
                        .eq('product_id', itemId);
                    if (transError) console.error('Error updating transaction product name:', transError);
                }

                await loadData();
                await updateDashboard();
                showNotification('Product updated successfully!', 'success');
                return true;

            } catch (error) {
                console.error('Product update failed:', error.message);
                showNotification('Product update failed: ' + error.message, 'error');
                return false;
            }
        }


        // --- Existing JavaScript Functions (Modified for Supabase) ---

        // Show notification (kept as is)
        function showNotification(message, type = 'info') {
            const existingNotifications = document.querySelectorAll('.notification-toast');
            existingNotifications.forEach(n => n.remove());
            
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500';
            
            notification.className = `notification-toast fixed top-4 right-4 ${bgColor} text-white px-4 py-3 rounded-lg shadow-lg z-50 max-w-sm transform transition-all duration-300 translate-x-full`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Password visibility toggle (kept as is)
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('eyeIcon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                eyeIcon.textContent = 'üëÅÔ∏è';
            }
        });

        // Login functionality (kept as is, password check is client-side)
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            if (password === currentPassword) {
                await loadData(); // Load data on successful login
                showPage('dashboardPage');
                errorDiv.classList.add('hidden');
                document.getElementById('password').value = '';
                showNotification('Welcome back!', 'success');
            } else {
                errorDiv.textContent = 'Invalid password. Please try again.';
                errorDiv.classList.remove('hidden');
            }
        });

        // Reset password functionality (kept as is, client-side only)
        document.getElementById('resetPasswordBtn').addEventListener('click', function() {
            showModal('resetPasswordModal');
        });

        document.getElementById('resetPasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // ... (Password reset logic remains client-side for this example)
            const email = document.getElementById('resetEmail').value.trim();
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('resetError');
            
            errorDiv.classList.add('hidden');
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                errorDiv.textContent = 'Please enter a valid email address.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (email.toLowerCase() !== 'adnan@addyfitness.com') {
                errorDiv.textContent = 'Email address not authorized for password reset.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (current !== currentPassword) {
                errorDiv.textContent = 'Current password is incorrect.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (newPass.length < 6) {
                errorDiv.textContent = 'New password must be at least 6 characters long.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (newPass !== confirm) {
                errorDiv.textContent = 'New passwords do not match.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            if (newPass === currentPassword) {
                errorDiv.textContent = 'New password must be different from current password.';
                errorDiv.classList.remove('hidden');
                return;
            }
            
            currentPassword = newPass;
            document.getElementById('resetPasswordForm').reset();
            closeModal('resetPasswordModal');
            showNotification('Password reset successfully!', 'success');
        });

        // Logout functionality (kept as is)
        document.getElementById('logoutBtn').addEventListener('click', function() {
            showPage('loginPage');
        });

        // Reset functionality (calls new Supabase function)
        document.getElementById('resetBtn').addEventListener('click', function() {
            if (inventory.length === 0 && vendors.length === 0 && transactions.length === 0) {
                showNotification('No data to reset - database is already empty', 'info');
                return;
            }
            showModal('resetConfirmModal');
        });

        // Stock In functionality (calls new Supabase function)
        document.getElementById('stockInForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Processing...';
            submitBtn.disabled = true;
            
            try {
                const productName = document.getElementById('stockInName').value.trim();
                if (!productName) throw new Error('Please enter a product name.');
                
                let sheetType = document.getElementById('stockInSheetType').value;
                if (sheetType === 'custom') {
                    sheetType = document.getElementById('customSheetType').value.trim();
                    if (!sheetType) throw new Error('Please enter a custom sheet type.');
                }
                if (!sheetType) throw new Error('Please select a sheet type.');
                
                let stickerType = document.getElementById('stockInStickerType').value;
                if (stickerType === 'custom') {
                    stickerType = document.getElementById('customStickerType').value.trim();
                    if (!stickerType) throw new Error('Please enter a custom sticker type.');
                }
                if (!stickerType) throw new Error('Please select a sticker type.');
                
                const vendor = document.getElementById('stockInVendor').value;
                if (!vendor) throw new Error('Please select a vendor.');
                
                const editingId = this.dataset.editingId;
                const mode = this.dataset.mode;

                let pieces;
                let piecesPerSheet;
                let costPerSheet;
                let totalPieces;
                let totalCost;
                let itemToUpdate = null;

                if (editingId && mode === 'addStock') {
                    // Adding stock to existing product (pieces only)
                    pieces = parseInt(document.getElementById('stockInPieces').value);
                    if (!pieces || pieces <= 0) throw new Error('Please enter a valid number of pieces to add.');
                    
                    itemToUpdate = inventory.find(i => i.id == editingId);
                    piecesPerSheet = itemToUpdate.piecesPerSheet;
                    costPerSheet = itemToUpdate.costPerSheet;

                    const costPerPiece = costPerSheet / piecesPerSheet;
                    totalCost = pieces * costPerPiece;
                    totalPieces = pieces; // Only adding pieces
                    
                } else {
                    // Creating new product or updating existing (sheets * pieces_per_sheet)
                    const sheets = parseInt(document.getElementById('stockInSheets').value);
                    piecesPerSheet = parseInt(document.getElementById('stockInPiecesPerSheet').value);
                    costPerSheet = parseFloat(document.getElementById('stockInCostPerSheet').value);
                    
                    if (!sheets || sheets <= 0) throw new Error('Please enter a valid number of sheets.');
                    if (!piecesPerSheet || piecesPerSheet <= 0) throw new Error('Please enter valid pieces per sheet.');
                    if (!costPerSheet || costPerSheet <= 0) throw new Error('Please enter a valid cost per sheet.');
                    
                    totalPieces = sheets * piecesPerSheet;
                    totalCost = sheets * costPerSheet;

                    // Check if product already exists
                    itemToUpdate = inventory.find(item => 
                        item.name === productName && 
                        item.sheetType === sheetType && 
                        item.stickerType === stickerType
                    );
                }
                
                const newProductData = {
                    name: productName,
                    sheetType: sheetType,
                    stickerType: stickerType,
                    pieces: totalPieces,
                    piecesPerSheet: piecesPerSheet,
                    costPerSheet: costPerSheet,
                    totalCost: totalCost,
                    vendor: vendor,
                    dateAdded: document.getElementById('stockInDate').value
                };
                
                const success = await addStockInTransaction(newProductData, itemToUpdate);
                
                if (success) {
                    // Reset form and UI
                    document.getElementById('stockInForm').reset();
                    document.getElementById('stockInDate').valueAsDate = new Date();
                    document.getElementById('customSheetType').classList.add('hidden');
                    document.getElementById('customStickerType').classList.add('hidden');
                    delete this.dataset.editingId;
                    delete this.dataset.mode;
                    closeModal('stockInModal');
                }
                
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Add Vendor functionality (calls new Supabase function)
        document.getElementById('addVendorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const vendorData = {
                name: document.getElementById('vendorName').value,
                contact: document.getElementById('vendorContact').value,
                phone: document.getElementById('vendorPhone').value,
                email: document.getElementById('vendorEmail').value,
                city: document.getElementById('vendorCity').value,
                state: document.getElementById('vendorState').value,
                address: document.getElementById('vendorAddress').value
            };
            
            const editingId = this.dataset.editingId ? parseInt(this.dataset.editingId) : null;

            await saveVendor(vendorData, editingId);

            // Clear editing state
            delete this.dataset.editingId;
        });

        // Utility functions (updated to be async/await where needed)
        async function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'stockPage') {
                await populateStockPage();
            } else if (pageId === 'stockValuePage') {
                await populateStockValuePage();
            } else if (pageId === 'vendorsPage') {
                await populateVendorsPage();
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // ... (showStockInModal, showStockOutModal, showAddVendorModal remain mostly the same) ...

        function showStockInModal() {
            document.getElementById('stockInForm').reset();
            document.getElementById('stockInDate').valueAsDate = new Date();
            
            // Reset form state
            document.getElementById('stockInName').readOnly = false;
            document.getElementById('stockInSheetType').disabled = false;
            document.getElementById('stockInStickerType').disabled = false;
            document.getElementById('stockInPiecesPerSheet').readOnly = false;
            document.getElementById('stockInCostPerSheet').readOnly = false;
            document.getElementById('stockInVendor').disabled = false;
            
            document.getElementById('sheetsField').style.display = 'block';
            document.getElementById('piecesPerSheetField').style.display = 'block';
            document.getElementById('piecesField').style.display = 'none';
            
            document.querySelector('#stockInModal h3').innerHTML = '<span class="text-3xl mr-3">üì•</span>Stock In';
            document.querySelector('#stockInForm button[type="submit"]').textContent = 'Add Stock';
            
            delete document.getElementById('stockInForm').dataset.editingId;
            delete document.getElementById('stockInForm').dataset.mode;
            
            showModal('stockInModal');
        }

        async function showStockOutModal() {
            await populateStockOutModal();
            showModal('stockOutModal');
        }

        function showAddVendorModal() {
            document.getElementById('addVendorForm').reset();
            document.querySelector('#addVendorModal h3').innerHTML = '<span class="text-3xl mr-3">üè™</span>Add New Vendor';
            document.querySelector('#addVendorForm button[type="submit"]').textContent = 'Add Vendor';
            delete document.getElementById('addVendorForm').dataset.editingId;
            showModal('addVendorModal');
        }
        
        // Update Dashboard (needs fresh data, so calls loadData is better in real app, but here, data is assumed to be fresh after CRUD)
        async function updateDashboard() {
            await loadData(); // Ensure the latest data is available
            
            // Update dashboard cards
            document.getElementById('totalStockCount').textContent = inventory.reduce((sum, item) => sum + item.pieces, 0);
            
            const currentStockValue = inventory.reduce((sum, item) => {
                const costPerPiece = item.costPerSheet / item.piecesPerSheet;
                return sum + (item.pieces * costPerPiece);
            }, 0);
            document.getElementById('totalStockValue').textContent = currentStockValue.toFixed(2);
            
            document.getElementById('totalVendors').textContent = vendors.length;
            
            // Update inventory grid
            const inventoryGrid = document.getElementById('inventoryGrid');
            document.getElementById('inventoryCount').textContent = inventory.length;
            
            if (inventory.length === 0) {
                inventoryGrid.innerHTML = `
                    <div class="col-span-full flex flex-col items-center justify-center py-12 sm:py-16">
                        <div class="text-6xl sm:text-8xl mb-4 sm:mb-6 opacity-30">üì¶</div>
                        <h3 class="text-xl sm:text-2xl font-bold text-gray-400 mb-2 sm:mb-3 text-center">No inventory items yet</h3>
                        <p class="text-gray-500 text-base sm:text-lg text-center">Add your first product to get started!</p>
                    </div>
                `;
            } else {
                inventoryGrid.innerHTML = inventory.map(item => {
                    const costPerPiece = item.costPerSheet / item.piecesPerSheet;
                    const currentValue = item.pieces * costPerPiece;
                    const formattedDate = new Date(item.dateAdded).toLocaleDateString('en-GB');
                    return `
                        <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 border-l-4 border-blue-500 hover:border-blue-600 transform hover:-translate-y-2 w-full flex flex-col overflow-hidden p-6">
                            <div class="text-center mb-4 flex-shrink-0">
                                <div class="text-3xl mb-2 opacity-80">üì¶</div>
                                <h3 class="text-lg font-bold text-gray-800 mb-3 leading-tight">${item.name}</h3>
                                <div class="flex flex-col gap-2">
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                        ${item.sheetType}
                                    </span>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                        ${item.stickerType}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="flex-1 mb-4 text-sm">
                                <div class="bg-gray-50 rounded-lg p-4 space-y-3 h-full flex flex-col justify-center">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Vendor:</span>
                                        <span class="font-bold text-purple-600">${item.vendor}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Stock:</span>
                                        <span class="font-bold text-blue-600 text-lg">${item.pieces} in pc</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Value:</span>
                                        <span class="font-bold text-green-600 text-lg">‚Çπ${currentValue.toFixed(0)}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Per piece:</span>
                                        <span class="font-semibold">‚Çπ${costPerPiece.toFixed(2)}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Added:</span>
                                        <span class="font-semibold">${formattedDate}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-100 rounded-lg p-3 flex-shrink-0 space-y-3">
    <div class="quick-stock-container">
        <input type="number" id="quickStock_${item.id}" min="1" placeholder="Qty" class="px-2 py-2 border border-gray-300 rounded text-sm font-medium">
        <button type="button" onclick="quickStockAdd(${item.id})" class="bg-green-500 text-white rounded hover:bg-green-600 transition-colors font-bold" title="Add Stock">
            +
        </button>
        <button type="button" onclick="quickStockRemove(${item.id})" class="bg-red-500 text-white rounded hover:bg-red-600 transition-colors font-bold" title="Remove Stock">
            -
        </button>
    </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button type="button" onclick="showProductHistory(${item.id})" class="bg-purple-500 text-white px-2 py-2 rounded hover:bg-purple-600 transition-colors text-sm font-bold" title="View History">
                                        üìä History
                                    </button>
                                    <button type="button" onclick="editProduct(${item.id})" class="bg-teal-500 text-white px-2 py-2 rounded hover:bg-teal-600 transition-colors text-sm font-bold" title="Edit Product">
                                        ‚úèÔ∏è Edit
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        async function populateStockPage() {
            await loadData();
            const stockDetails = document.getElementById('stockDetails');
            // ... (Rest of populateStockPage logic remains the same, using the updated 'inventory' array) ...
            if (inventory.length === 0) {
                stockDetails.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8"><div class="text-6xl mb-4">üì¶</div>No stock items found.</div>';
            } else {
                stockDetails.innerHTML = inventory.map(item => {
                    const costPerPiece = item.costPerSheet / item.piecesPerSheet;
                    const currentValue = item.pieces * costPerPiece;
                    const formattedDate = new Date(item.dateAdded).toLocaleDateString('en-GB');
                    return `
                        <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 border-l-4 border-blue-500 hover:border-blue-600 transform hover:-translate-y-2 w-full flex flex-col overflow-hidden p-6">
                            <div class="text-center mb-4 flex-shrink-0">
                                <div class="text-3xl mb-2 opacity-80">üì¶</div>
                                <h3 class="text-lg font-bold text-gray-800 mb-3 leading-tight">${item.name}</h3>
                                <div class="flex flex-col gap-2">
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                        ${item.sheetType}
                                    </span>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                        ${item.stickerType}
                                    </span>
                                </div>
                            </div>
                            
                            <div class="flex-1 mb-4 text-sm">
                                <div class="bg-gray-50 rounded-lg p-4 space-y-3 h-full flex flex-col justify-center">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Vendor:</span>
                                        <span class="font-bold text-purple-600">${item.vendor}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Stock:</span>
                                        <span class="font-bold text-blue-600 text-lg">${item.pieces} in pc</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Value:</span>
                                        <span class="font-bold text-green-600 text-lg">‚Çπ${currentValue.toFixed(0)}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Per piece:</span>
                                        <span class="font-semibold">‚Çπ${costPerPiece.toFixed(2)}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600 font-medium">Added:</span>
                                        <span class="font-semibold">${formattedDate}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-100 rounded-lg p-3 flex-shrink-0 space-y-3">
    <div class="quick-stock-container">
        <input type="number" id="stockPageQuick_${item.id}" min="1" placeholder="Qty" class="px-2 py-2 border border-gray-300 rounded text-sm font-medium">
        <button type="button" onclick="stockPageQuickAdd(${item.id})" class="bg-green-500 text-white rounded hover:bg-green-600 transition-colors font-bold" title="Add Stock">
            +
        </button>
        <button type="button" onclick="stockPageQuickRemove(${item.id})" class="bg-red-500 text-white rounded hover:bg-red-600 transition-colors font-bold" title="Remove Stock">
            -
        </button>
    </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button type="button" onclick="showProductHistory(${item.id})" class="bg-purple-500 text-white px-2 py-2 rounded hover:bg-purple-600 transition-colors text-sm font-bold" title="View History">
                                        üìä History
                                    </button>
                                    <button type="button" onclick="editProduct(${item.id})" class="bg-teal-500 text-white px-2 py-2 rounded hover:bg-teal-600 transition-colors text-sm font-bold" title="Edit Product">
                                        ‚úèÔ∏è Edit
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        async function populateStockValuePage() {
            await loadData();
            const stockValueDetails = document.getElementById('stockValueDetails');
            // ... (Rest of populateStockValuePage logic remains the same, using the updated 'inventory' array) ...
            if (inventory.length === 0) {
                stockValueDetails.innerHTML = '<div class="text-center text-gray-500 py-8"><div class="text-6xl mb-4">üí∞</div>No stock value data found.</div>';
            } else {
                // Calculate sticker type breakdown
                const stickerTypeBreakdown = {};
                inventory.forEach(item => {
                    if (!stickerTypeBreakdown[item.stickerType]) {
                        stickerTypeBreakdown[item.stickerType] = {
                            pieces: 0,
                            value: 0,
                            products: 0
                        };
                    }
                    const costPerPiece = item.costPerSheet / item.piecesPerSheet;
                    const itemValue = item.pieces * costPerPiece;
                    
                    stickerTypeBreakdown[item.stickerType].pieces += item.pieces;
                    stickerTypeBreakdown[item.stickerType].value += itemValue;
                    stickerTypeBreakdown[item.stickerType].products += 1;
                });

                stockValueDetails.innerHTML = `
                    <div class="bg-gradient-to-r from-green-100 to-blue-100 rounded-xl p-3 sm:p-4 mb-6 border border-green-200">
                        <h3 class="text-base sm:text-lg font-bold text-gray-800 mb-3 flex items-center">
                            <span class="text-xl mr-2">üìä</span>
                            Stock Breakdown by Sticker Type
                        </h3>
                        
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${Object.entries(stickerTypeBreakdown).map(([stickerType, data]) => `
                                <div class="bg-white rounded-lg px-3 py-2 border border-gray-200 shadow-sm hover:shadow-md transition-all hover:scale-105 cursor-pointer">
                                    <div class="text-center">
                                        <div class="font-bold text-gray-800 text-xs mb-1">${stickerType}</div>
                                        <div class="flex items-center justify-center space-x-2 text-xs">
                                            <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full font-medium">${data.pieces}pc</span>
                                            <span class="bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium">‚Çπ${data.value.toFixed(0)}</span>
                                            <span class="bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-medium">${data.products}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                            <div class="flex items-center justify-center space-x-4 sm:space-x-8 text-sm">
                                <div class="text-center">
                                    <div class="text-gray-600 text-xs">Total Pieces</div>
                                    <div class="font-bold text-blue-600">${inventory.reduce((sum, item) => sum + item.pieces, 0)}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-gray-600 text-xs">Total Value</div>
                                    <div class="font-bold text-green-600">‚Çπ${Object.values(stickerTypeBreakdown).reduce((sum, data) => sum + data.value, 0).toFixed(0)}</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-gray-600 text-xs">Total Products</div>
                                    <div class="font-bold text-purple-600">${inventory.length}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                        ${inventory.map(item => {
                            const costPerPiece = item.costPerSheet / item.piecesPerSheet;
                            const currentValue = item.pieces * costPerPiece;
                            const formattedDate = new Date(item.dateAdded).toLocaleDateString('en-GB');
                            return `
                                <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border-l-4 border-green-500 hover:border-green-600 transform hover:-translate-y-1 p-6">
                                    <div class="text-center mb-3">
                                        <div class="text-2xl mb-1 opacity-80">üí∞</div>
                                        <h3 class="text-base font-bold text-gray-800 mb-2 leading-tight">${item.name}</h3>
                                        <div class="flex flex-col gap-1">
                                            <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-medium">
                                                ${item.vendor}
                                            </span>
                                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">
                                                ${item.sheetType}
                                            </span>
                                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">
                                                ${item.stickerType}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="text-xs">
                                        <div class="bg-white rounded-lg p-3 space-y-2">
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-600 font-medium">Stock:</span>
                                                <span class="font-bold text-blue-600">${item.pieces} pc</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-600 font-medium">Sheet Cost:</span>
                                                <span class="font-semibold">‚Çπ${item.costPerSheet.toFixed(2)}</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-600 font-medium">Piece Cost:</span>
                                                <span class="font-semibold">‚Çπ${costPerPiece.toFixed(2)}</span>
                                            </div>
                                            <div class="flex justify-between items-center border-t pt-2">
                                                <span class="text-gray-700 font-bold">Total Value:</span>
                                                <span class="font-bold text-green-600 text-sm">‚Çπ${currentValue.toFixed(2)}</span>
                                            </div>
                                            <div class="flex justify-between items-center">
                                                <span class="text-gray-600 font-medium">Added:</span>
                                                <span class="font-semibold">${formattedDate}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
        }

        async function populateVendorsPage() {
            await loadData();
            const vendorsDetails = document.getElementById('vendorsDetails');
            // ... (Rest of populateVendorsPage logic remains the same, using the updated 'vendors' array) ...
            if (vendors.length === 0) {
                vendorsDetails.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8"><div class="text-6xl mb-4">üè™</div>No vendors found. Add your first vendor!</div>';
            } else {
                vendorsDetails.innerHTML = vendors.map(vendor => {
                    const vendorProducts = inventory.filter(item => item.vendor === vendor.name);
                    const totalProducts = vendorProducts.length;
                    const totalValue = vendorProducts.reduce((sum, item) => {
                        const costPerPiece = item.costPerSheet / item.piecesPerSheet;
                        return sum + (item.pieces * costPerPiece);
                    }, 0);
                    
                    return `
                        <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-6 border border-purple-200 hover:shadow-lg transition-all cursor-pointer card-hover">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-bold text-gray-800 text-lg">${vendor.name}</h3>
                                <div class="text-2xl">üè™</div>
                            </div>
                            <div class="space-y-2 mb-4">
                                <p class="text-sm text-gray-600"><strong>Contact:</strong> ${vendor.contact}</p>
                                <p class="text-sm text-gray-600"><strong>Phone:</strong> ${vendor.phone}</p>
                                <p class="text-sm text-gray-600"><strong>Email:</strong> ${vendor.email || 'N/A'}</p>
                                <div class="grid grid-cols-2 gap-2">
                                    <p class="text-sm text-gray-600"><strong>City:</strong> ${vendor.city}</p>
                                    <p class="text-sm text-gray-600"><strong>State:</strong> ${vendor.state}</p>
                                </div>
                                <div class="bg-white rounded-lg p-3 mt-3">
                                    <p class="text-sm font-semibold text-purple-600"><strong>Products:</strong> ${totalProducts}</p>
                                    <p class="text-sm font-semibold text-purple-600"><strong>Total Value:</strong> ‚Çπ${totalValue.toFixed(2)}</p>
                                </div>
                            </div>
                            
                            <div class="flex space-x-2 mt-4">
                                <button onclick="editVendor(${vendor.id})" class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteVendor(${vendor.id}, '${vendor.name}')" class="flex-1 bg-red-500 text-white py-2 px-3 rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        async function populateStockOutModal() {
            await loadData();
            const stockOutList = document.getElementById('stockOutList');
            // ... (Rest of populateStockOutModal logic remains the same, using the updated 'inventory' array) ...
            if (inventory.length === 0) {
                stockOutList.innerHTML = '<div class="text-center text-gray-500 py-8">No stock available for stock out.</div>';
            } else {
                stockOutList.innerHTML = inventory.map(item => `
                    <div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold text-gray-800">${item.name}</h4>
                            <p class="text-sm text-gray-600">${item.sheetType} - ${item.stickerType}</p>
                            <p class="text-sm text-gray-600">Available: ${item.pieces} pieces</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="stockOut_${item.id}" min="1" max="${item.pieces}" placeholder="Pieces" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm">
                            <button onclick="processStockOut(${item.id})" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors text-sm">
                                Stock Out
                            </button>
                        </div>
                    </div>
                `).join('');
            }
        }

        async function populateVendorDropdowns() {
            await loadData();
            const stockInVendor = document.getElementById('stockInVendor');
            stockInVendor.innerHTML = '<option value="">Select Vendor</option>' + 
                vendors.map(vendor => `<option value="${vendor.name}">${vendor.name}</option>`).join('');
        }

        // Quick stock management functions (call Supabase functions)
        async function quickStockAdd(itemId) {
            const quantityInput = document.getElementById(`quickStock_${itemId}`);
            const quantity = parseInt(quantityInput.value);
            
            if (!quantity || quantity <= 0) {
                showNotification('Please enter a valid quantity.', 'error');
                return;
            }
            
            const item = inventory.find(i => i.id === itemId);
            if (!item) return;

            const costPerPiece = item.costPerSheet / item.piecesPerSheet;
            const addedCost = quantity * costPerPiece;
            
            const newProductData = {
                name: item.name,
                sheetType: item.sheetType,
                stickerType: item.stickerType,
                pieces: quantity,
                piecesPerSheet: item.piecesPerSheet,
                costPerSheet: item.costPerSheet,
                totalCost: addedCost,
                vendor: item.vendor,
                dateAdded: new Date().toISOString().split('T')[0]
            };

            const success = await addStockInTransaction(newProductData, item);
            
            if (success) {
                quantityInput.value = '';
                await updateDashboard();
                showNotification(`Added ${quantity} pieces to ${item.name}`, 'success');
            }
        }

        async function quickStockRemove(itemId) {
            const quantityInput = document.getElementById(`quickStock_${itemId}`);
            const quantity = parseInt(quantityInput.value);
            
            if (!quantity || quantity <= 0) {
                showNotification('Please enter a valid quantity.', 'error');
                return;
            }
            
            const item = inventory.find(i => i.id === itemId);
            
            if (quantity > item.pieces) {
                showNotification('Insufficient stock available.', 'error');
                return;
            }
            
            const success = await processStockOutSupabase(itemId, quantity, item);
            
            if (success) {
                quantityInput.value = '';
                await updateDashboard();
                showNotification(`Removed ${quantity} pieces from ${item.name}`, 'success');
            }
        }

        async function processStockOut(itemId) {
            const item = inventory.find(i => i.id === itemId);
            const quantityInput = document.getElementById(`stockOut_${itemId}`);
            const quantity = parseInt(quantityInput.value);
            
            if (!quantity || quantity <= 0) {
                showNotification('Please enter a valid quantity.', 'error');
                return;
            }
            
            if (quantity > item.pieces) {
                showNotification('Insufficient stock available.', 'error');
                return;
            }
            
            const success = await processStockOutSupabase(itemId, quantity, item);
            
            if (success) {
                closeModal('stockOutModal');
                showNotification(`Removed ${quantity} pieces from ${item.name}`, 'success');
            }
        }

        function stockInProduct(itemId) {
            // ... (Remains the same, but calls showStockInModal/addStockInTransaction which uses Supabase)
            const item = inventory.find(i => i.id === itemId);
            
            document.getElementById('stockInName').value = item.name;
            document.getElementById('stockInSheetType').value = item.sheetType;
            document.getElementById('stockInStickerType').value = item.stickerType;
            document.getElementById('stockInPiecesPerSheet').value = item.piecesPerSheet;
            document.getElementById('stockInCostPerSheet').value = item.costPerSheet;
            document.getElementById('stockInVendor').value = item.vendor;
            document.getElementById('stockInPieces').value = '';
            document.getElementById('stockInSheets').value = '';
            document.getElementById('stockInDate').valueAsDate = new Date();
            
            document.getElementById('stockInName').readOnly = true;
            document.getElementById('stockInSheetType').disabled = true;
            document.getElementById('stockInStickerType').disabled = true;
            document.getElementById('stockInPiecesPerSheet').readOnly = true;
            document.getElementById('stockInCostPerSheet').readOnly = true;
            document.getElementById('stockInVendor').disabled = true;
            
            document.getElementById('sheetsField').style.display = 'none';
            document.getElementById('piecesPerSheetField').style.display = 'none';
            document.getElementById('piecesField').style.display = 'block';
            
            document.querySelector('#stockInModal h3').innerHTML = '<span class="text-3xl mr-3">üì•</span>Add Stock - ' + item.name;
            document.querySelector('#stockInForm button[type="submit"]').textContent = 'Add Stock';
            
            document.getElementById('stockInForm').dataset.editingId = itemId;
            document.getElementById('stockInForm').dataset.mode = 'addStock';
            
            showModal('stockInModal');
        }

        function stockOutProduct(itemId) {
            // ... (Remains the same, but calls processStockOut which uses Supabase)
            const item = inventory.find(i => i.id === itemId);
            
            const stockOutList = document.getElementById('stockOutList');
            stockOutList.innerHTML = `
                <div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between">
                    <div>
                        <h4 class="font-semibold text-gray-800">${item.name}</h4>
                        <p class="text-sm text-gray-600">${item.sheetType} - ${item.stickerType}</p>
                        <p class="text-sm text-gray-600">Available: ${item.pieces} pieces</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <input type="number" id="stockOut_${item.id}" min="1" max="${item.pieces}" placeholder="Pieces" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm">
                        <button onclick="processStockOut(${item.id})" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition-colors text-sm">
                            Stock Out
                        </button>
                    </div>
                </div>
            `;
            
            showModal('stockOutModal');
        }

        // Handle custom type selection (kept as is)
        function handleCustomType(type) {
            const selectElement = document.getElementById(`stockIn${type.charAt(0).toUpperCase() + type.slice(1)}Type`);
            const customInput = document.getElementById(`custom${type.charAt(0).toUpperCase() + type.slice(1)}Type`);
            
            if (selectElement.value === 'custom') {
                customInput.classList.remove('hidden');
                customInput.required = true;
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.required = false;
                customInput.value = '';
            }
        }

        // Stock page quick management functions (call Supabase functions)
        async function stockPageQuickAdd(itemId) {
            const quantityInput = document.getElementById(`stockPageQuick_${itemId}`);
            const quantity = parseInt(quantityInput.value);
            
            if (!quantity || quantity <= 0) {
                showNotification('Please enter a valid quantity.', 'error');
                return;
            }
            
            const item = inventory.find(i => i.id === itemId);
            if (!item) return;

            const costPerPiece = item.costPerSheet / item.piecesPerSheet;
            const addedCost = quantity * costPerPiece;
            
            const newProductData = {
                name: item.name,
                sheetType: item.sheetType,
                stickerType: item.stickerType,
                pieces: quantity,
                piecesPerSheet: item.piecesPerSheet,
                costPerSheet: item.costPerSheet,
                totalCost: addedCost,
                vendor: item.vendor,
                dateAdded: new Date().toISOString().split('T')[0]
            };

            const success = await addStockInTransaction(newProductData, item);
            
            if (success) {
                quantityInput.value = '';
                await updateDashboard();
                await populateStockPage();
                showNotification(`Added ${quantity} pieces to ${item.name}`, 'success');
            }
        }

        async function stockPageQuickRemove(itemId) {
            const quantityInput = document.getElementById(`stockPageQuick_${itemId}`);
            const quantity = parseInt(quantityInput.value);
            
            if (!quantity || quantity <= 0) {
                showNotification('Please enter a valid quantity.', 'error');
                return;
            }
            
            const item = inventory.find(i => i.id === itemId);
            
            if (quantity > item.pieces) {
                showNotification('Insufficient stock available.', 'error');
                return;
            }
            
            const success = await processStockOutSupabase(itemId, quantity, item);
            
            if (success) {
                quantityInput.value = '';
                await updateDashboard();
                await populateStockPage();
                showNotification(`Removed ${quantity} pieces from ${item.name}`, 'success');
            }
        }

        // Product History and Edit functions (updated to call loadData and use Supabase data)
        async function showProductHistory(itemId) {
            await loadData();
            const item = inventory.find(i => i.id === itemId);
            if (!item) return;
            
            document.getElementById('historyProductName').textContent = item.name;
            
            // Get all transactions for this specific product using productId
            const productTransactions = transactions.filter(t => t.productId === itemId);
            
            const historyContent = document.getElementById('productHistoryContent');
            
            if (productTransactions.length === 0) {
                historyContent.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-6xl mb-4 opacity-30">üìä</div>
                        <h3 class="text-xl font-bold text-gray-400 mb-2">No transaction history</h3>
                        <p class="text-gray-500">This product has no recorded transactions yet.</p>
                    </div>
                `;
            } else {
                // Sort transactions by date and time (newest first)
                productTransactions.sort((a, b) => {
                    const dateA = new Date(a.date + ' ' + a.time);
                    const dateB = new Date(b.date + ' ' + b.time);
                    return dateB - dateA;
                });
                
                historyContent.innerHTML = `
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <h4 class="font-bold text-blue-800 mb-2">Product Summary</h4>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-blue-600 font-medium">Current Stock:</span>
                                <p class="font-bold">${item.pieces} pieces</p>
                            </div>
                            <div>
                                <span class="text-blue-600 font-medium">Sheet Type:</span>
                                <p class="font-bold">${item.sheetType}</p>
                            </div>
                            <div>
                                <span class="text-blue-600 font-medium">Sticker Type:</span>
                                <p class="font-bold">${item.stickerType}</p>
                            </div>
                            <div>
                                <span class="text-blue-600 font-medium">Vendor:</span>
                                <p class="font-bold">${item.vendor}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <h4 class="font-bold text-gray-800 text-lg">Transaction History</h4>
                            <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                ${productTransactions.length} transaction${productTransactions.length !== 1 ? 's' : ''}
                            </div>
                        </div>
                        ${productTransactions.map((transaction, index) => {
                            const isStockIn = transaction.type === 'Stock In';
                            const formattedDate = new Date(transaction.date).toLocaleDateString('en-GB');
                            const serialNumber = index + 1;
                            return `
                                <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-3">
                                            <div class="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-xs font-bold">
                                                #${serialNumber}
                                            </div>
                                            <span class="text-lg">${isStockIn ? 'üì•' : 'üì§'}</span>
                                            <span class="font-semibold ${isStockIn ? 'text-green-600' : 'text-red-600'}">${transaction.type}</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm text-gray-500">${formattedDate}</div>
                                            <div class="text-xs text-gray-400">${transaction.time}</div>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div>
                                            <span class="text-gray">Quantity:</span>
                                            <span class="font-medium ml-2 ${isStockIn ? 'text-green-600' : 'text-red-600'}">
                                                ${isStockIn ? '+' : '-'}${transaction.quantity} pieces
                                            </span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600">Value:</span>
                                            <span class="font-medium ml-2">‚Çπ${transaction.cost.toFixed(2)}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            
            showModal('productHistoryModal');
        }

        function editProduct(itemId) {
            const item = inventory.find(i => i.id === itemId);
            if (!item) return;
            
            // Populate form with current product data
            document.getElementById('editProductName').value = item.name;
            document.getElementById('editProductSheetType').value = item.sheetType;
            document.getElementById('editProductStickerType').value = item.stickerType;
            document.getElementById('editProductPiecesPerSheet').value = item.piecesPerSheet;
            document.getElementById('editProductCostPerSheet').value = item.costPerSheet;
            
            // Populate vendor dropdown
            const editVendorSelect = document.getElementById('editProductVendor');
            editVendorSelect.innerHTML = '<option value="">Select Vendor</option>' + 
                vendors.map(vendor => `<option value="${vendor.name}">${vendor.name}</option>`).join('');
            editVendorSelect.value = item.vendor;
            
            // Set editing mode
            document.getElementById('editProductForm').dataset.editingId = itemId;
            
            showModal('editProductModal');
        }

        // Handle custom type selection in edit form (kept as is)
        function handleEditCustomType(type) {
            const selectElement = document.getElementById(`editProduct${type.charAt(0).toUpperCase() + type.slice(1)}Type`);
            const customInput = document.getElementById(`editCustom${type.charAt(0).toUpperCase() + type.slice(1)}Type`);
            
            if (selectElement.value === 'custom') {
                customInput.classList.remove('hidden');
                customInput.required = true;
                customInput.focus();
            } else {
                customInput.classList.add('hidden');
                customInput.required = false;
                customInput.value = '';
            }
        }

        // Edit Product form submission (calls Supabase function)
        document.getElementById('editProductForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Updating...';
            submitBtn.disabled = true;
            
            try {
                const editingId = parseInt(this.dataset.editingId);
                
                // Get form values and validate
                const productName = document.getElementById('editProductName').value.trim();
                if (!productName) throw new Error('Please enter a product name.');
                
                let sheetType = document.getElementById('editProductSheetType').value;
                if (sheetType === 'custom') {
                    sheetType = document.getElementById('editCustomSheetType').value.trim();
                    if (!sheetType) throw new Error('Please enter a custom sheet type.');
                }
                if (!sheetType) throw new Error('Please select a sheet type.');
                
                let stickerType = document.getElementById('editProductStickerType').value;
                if (stickerType === 'custom') {
                    stickerType = document.getElementById('editCustomStickerType').value.trim();
                    if (!stickerType) throw new Error('Please enter a custom sticker type.');
                }
                if (!stickerType) throw new Error('Please select a sticker type.');
                
                const vendor = document.getElementById('editProductVendor').value;
                if (!vendor) throw new Error('Please select a vendor.');
                
                const piecesPerSheet = parseInt(document.getElementById('editProductPiecesPerSheet').value);
                const costPerSheet = parseFloat(document.getElementById('editProductCostPerSheet').value);
                
                if (!piecesPerSheet || piecesPerSheet <= 0) throw new Error('Please enter valid pieces per sheet.');
                if (!costPerSheet || costPerSheet <= 0) throw new Error('Please enter a valid cost per sheet.');
                
                // Prepare update object for Supabase
                const updateObject = {
                    name: productName,
                    sheet_type: sheetType,
                    sticker_type: stickerType,
                    pieces_per_sheet: piecesPerSheet,
                    cost_per_sheet: costPerSheet,
                    vendor: vendor
                    // Note: total_cost and pieces are not updated here, only product meta data
                };
                
                const success = await updateProduct(editingId, updateObject);
                
                if (success) {
                    // Reset form and UI
                    closeModal('editProductModal');
                    document.getElementById('editProductForm').reset();
                    document.getElementById('editCustomSheetType').classList.add('hidden');
                    document.getElementById('editCustomStickerType').classList.add('hidden');
                    delete this.dataset.editingId;

                    const currentPage = document.querySelector('.page.active').id;
                    if (currentPage === 'stockPage') {
                        await populateStockPage();
                    } else if (currentPage === 'stockValuePage') {
                        await populateStockValuePage();
                    }
                }
                
            } catch (error) {
                showNotification(error.message, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Vendor management functions (kept as is, but calls Supabase functions)
        let vendorToDelete = null;

        function editVendor(vendorId) {
            const vendor = vendors.find(v => v.id === vendorId);
            if (!vendor) return;
            
            // Populate form with vendor data
            document.getElementById('vendorName').value = vendor.name;
            document.getElementById('vendorContact').value = vendor.contact;
            document.getElementById('vendorPhone').value = vendor.phone;
            document.getElementById('vendorEmail').value = vendor.email || '';
            document.getElementById('vendorCity').value = vendor.city;
            document.getElementById('vendorState').value = vendor.state;
            document.getElementById('vendorAddress').value = vendor.address;
            
            // Update modal title and button
            document.querySelector('#addVendorModal h3').innerHTML = '<span class="text-3xl mr-3">‚úèÔ∏è</span>Edit Vendor';
            document.querySelector('#addVendorForm button[type="submit"]').textContent = 'Update Vendor';
            
            // Set editing mode
            document.getElementById('addVendorForm').dataset.editingId = vendorId;
            
            showModal('addVendorModal');
        }

        function deleteVendor(vendorId, vendorName) {
            const vendorProducts = inventory.filter(item => item.vendor === vendorName);
            
            vendorToDelete = vendorId;
            document.getElementById('deleteVendorName').textContent = vendorName;
            
            if (vendorProducts.length > 0) {
                document.getElementById('deleteVendorWarning').textContent = 
                    `Warning: This vendor has ${vendorProducts.length} product(s) in inventory. Deleting this vendor will not affect existing inventory items, but you won't be able to add new stock from this vendor.`;
            } else {
                document.getElementById('deleteVendorWarning').textContent = 
                    'This vendor has no products in inventory.';
            }
            
            showModal('deleteVendorModal');
        }

        // Close modals when clicking outside (kept as is)
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });
    </script>
    
    <footer class="bg-gray-900/90 backdrop-blur-lg border-t border-gray-700/50 p-2 mt-8">
        <div class="text-center">
            <p class="text-gray-400 text-xs">All rights reserved by Pixel Web Pages ¬© 2025</p>
        </div>
    </footer>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'993b1de8f3f529f5',t:'MTc2MTMyNjEzMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>